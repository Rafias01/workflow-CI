name: Bank Churn - CI Training Only

permissions:
  contents: read  # Tidak perlu write karena tidak commit apa-apa

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  train-model:
    runs-on: ubuntu-latest
    env:
      PYTHON_VERSION: "3.9"

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install mlflow[extras] scikit-learn pandas joblib cloudpickle

      - name: Train model & log ke MLflow
        working-directory: MLProject
        run: |
          python modelling.py
          echo "Pelatihan selesai!"
          echo "Folder mlruns telah dibuat secara otomatis oleh MLflow di: $(pwd)/mlruns"

      - name: Upload folder mlruns sebagai Artifact
        uses: actions/upload-artifact@v4
        with:
          name: mlruns-full-tracking-${{ github.run_number }}
          path: MLProject/mlruns/
          retention-days: 90
          if-no-files-found: error  # Pastikan folder ada

      - name: Summary
        run: |
          echo "========================================"
          echo "PIPELINE CI BERHASIL SELESAI!"
          echo "✓ Model berhasil dilatih"
          echo "✓ Semua metrics, params, dan model di-log ke MLflow"
          echo "✓ Folder mlruns lengkap telah di-upload sebagai Artifact"
          echo ""
          echo "Cara melihat hasil:"
          echo "1. Buka GitHub → Actions → Run terbaru ini"
          echo "2. Download artifact: mlruns-full-tracking-*"
          echo "3. Extract folder mlruns"
          echo "4. Jalankan perintah: mlflow ui --backend-store-uri mlruns"
          echo "5. Buka browser: http://localhost:5000"
          echo "========================================"